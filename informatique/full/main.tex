\documentclass[a4paper]{book}

\input{../preamble.tex}

\usepackage{pgfornament}
\usepackage{tikzit}
\usepackage{minitoc}
\usepackage{titlesec}
\usepackage[open=true]{bookmark}

\input{../styles.tikzstyles}

\let\prefix\relax

\let\oldsection\section
\let\oldsubsection\subsection
\def\section#1{\setbox0=\hbox{\prefix}\oldsection[\kern\wd0#1]{#1}}
\def\subsection#1{\setbox0=\hbox{\prefix}\oldsubsection[\kern\wd0#1]{#1}}
\newbox\spacebox

\renewcommand{\listalgorithmname}{Liste des algorithmes}
\renewcommand{\lstlistlistingname}{Liste des codes}
\AtBeginDocument{
	\addtocontents{loa}{\linespread{2}\selectfont}
	\def\thechapter{
		\setbox\spacebox=\hbox{\relax$-$\ }\kern-\wd\spacebox
		\ifnum\value{chapter}<0%
			$-\text{\number-\value{chapter}}$%
		\else
			$\mathop{\phantom{-}}\text{\arabic{chapter}}$%
		\fi
	}
	\def\thefigure{\prefix\thechapter.\arabic{figure}}
	\def\thetable{\prefix\thechapter.\arabic{table}}
	\def\thealgorithm{\prefix\thechapter.\arabic{algorithm}}
	\def\thelstlisting{\prefix\thechapter.\arabic{lstlisting}}
	\def\thesection{\prefix\thechapter.\arabic{section}}
	\def\thesubsection{\prefix\thechapter.\arabic{section}.\arabic{subsection}}
}

\pagestyle{fancy}

\fancyfoot[C]{--\:\thepage\:--}

\fancypagestyle{plain}{
	\fancyhead{}
	\fancyfoot{}
	\fancyfoot[C]{--\:\thepage\:--}
	\renewcommand{\headrulewidth}{0pt}
}

\makeatletter
\titleformat{\part}[display]
  {\fontsize{45pt}{45pt}\bfseries\scshape\selectfont\filright}
  {{\LARGE\mdseries Partie \Roman{part}}}
  {20pt}
  {\thispagestyle{empty}}
\makeatother

\fancypagestyle{empty}{
	\fancyhead{}
	\fancyfoot{}
	\renewcommand{\headrulewidth}{0pt}
}

\makeatletter
\let\@tikzfig\tikzfig
\renewcommand{\tikzfig}[1]{\@tikzfig{{\cwd}figures/#1}}
\makeatother

\newcommand\blankpage{%
    \null%
    \thispagestyle{empty}%
    \addtocounter{page}{-1}}

\newcommand{\chap}[2][0]{
	\setcounter{chapter}{#1 - 1}
	\chapter{#2}
	\renewcommand*\parttitle{#2}
}

\newcommand{\td}[2][1]{
	\setcounter{chapter}{#1 - 1}
	\chapter{#2}
	\renewcommand*\parttitle{#2}
}

\renewcommand{\evensidemargin}{54pt}
\let\oddsidemargin\evensidemargin

\makeatletter
\def\cleardoublepage{%
	\clearpage%
	\if@twoside%
		\ifodd%
			\c@page%
		\else%
			\null%
			\thispagestyle{empty}%
			\newpage%
			\if@twocolumn%
				\hbox{}%
				\newpage%
			\fi%
		\fi%
	\fi%
}
\makeatother

\mtcselectlanguage{french}

\begin{document}
	\begin{titlepage}
		\blankpage
		\begin{center}
			{\LARGE \itshape 2022--2023}\\
			\vspace{3cm}
			\pgfornament[width=8cm]{88}\\
			\vspace{2mm}
			\vspace{0.5cm}
			{\HUGE Informatique}\\
			\vspace{0.5cm}
			{\fontsize{75pt}{100pt}\selectfont $\hbox{MPI}^\star$}\\
			\vspace{0.5cm}
			\pgfornament[width=8cm]{88}\\
			\vfill
			{\LARGE Hugo {\sc Salou}}\\
		\end{center}
	\end{titlepage}

	\renewcommand{\headrulewidth}{0pt}
	\fancyhead{}
	\fancyfoot{}
	\fancyfoot[C]{--\:\thepage\:--}

	\frontmatter
	\dominitoc
	\tableofcontents
	\listoffigures
	\listoftables
	\listofalgorithms
	\lstlistoflistings

	\mainmatter
	\renewcommand{\headrulewidth}{0.4pt}
	\fancyhead[R]{{\it MPI}\/$^\star$}
	\fancyhead[L]{\thesection}
	\fancyhead[C]{\parttitle}

	\part{Cours}

	{
		\chap[-1]{Ordres et induction}
		\minitoc
		\renewcommand{\cwd}{../cours/chap-01/}
		\input{../cours/chap-01/l1.tex}
		\input{../cours/chap-01/l2.tex}
	}

	{
		\chap[0]{Logique}
		\minitoc
		\renewcommand{\cwd}{../cours/chap00/}
		\input{../cours/chap00/l1.tex}
		\input{../cours/chap00/l2.tex}
		\input{../cours/chap00/l3.tex}
		\input{../cours/chap00/l4.tex}
	}

	{
		\chap[1]{Langages réguliers et Automates}
		\minitoc
		\renewcommand{\cwd}{../cours/chap01/}
		\input{../cours/chap01/l1.tex}
		\input{../cours/chap01/l2.tex}
		\input{../cours/chap01/l3.tex}
		\input{../cours/chap01/l4.tex}
		\input{../cours/chap01/l5.tex}
		\input{../cours/chap01/l6.tex}
		\input{../cours/chap01/l7.tex}
		\input{../cours/chap01/l8.tex}
		\input{../cours/chap01/l9.tex}
		\clearpage
		\setcounter{section}{0}
		\renewcommand{\thesection}{\llap{Annexe }\thechapter.\Alph{section}}
		\input{../cours/chap01/a1.tex}
		\input{../cours/chap01/a2.tex}
	}

	{
		\chap[2]{Algorithmes probabilistes}
		\minitoc
		\renewcommand{\cwd}{../cours/chap02/}
		\input{../cours/chap02/l1.tex}
		\input{../cours/chap02/l2.tex}
		\input{../cours/chap02/l3.tex}
		\clearpage
		\setcounter{section}{0}
		\renewcommand{\thesection}{\llap{Annexe }\thechapter.\Alph{section}}
		\input{../cours/chap02/a1.tex}
	}

	{
		\chap[3]{Apprentissage}
		\minitoc
		\renewcommand{\cwd}{../cours/chap03/}
		\input{../cours/chap03/l1.tex}
		\input{../cours/chap03/l2.tex}
	}

	\part{Travaux Dirigés}
	\def\prefix{\textsc{td}}
	
	\renewcommand{\chaptername}{Travaux Dirigés}

	{
		\td[1]{Ordre \& Induction}
		\renewcommand{\cwd}{../td/td01/}
		\input{../td/td01/ex1.tex}
		\input{../td/td01/ex2.tex}
		\input{../td/td01/ex3.tex}
		\input{../td/td01/ex4.tex}
		\input{../td/td01/ex5.tex}
		\input{../td/td01/ex6.tex}
		\input{../td/td01/ex7.tex}
		\input{../td/td01/ex8.tex}
	}

	{
		\td[2]{Logique propositionnelle}
		\renewcommand{\cwd}{../td/td02/}
		\input{../td/td02/ex1.tex}
		\input{../td/td02/ex2.tex}
		\input{../td/td02/ex3.tex}
		\input{../td/td02/ex4.tex}
		\input{../td/td02/ex5.tex}
		\input{../td/td02/ex6.tex}
		\input{../td/td02/ex7.tex}
		\input{../td/td02/ex8.tex}
	}

	{
		\td[3]{Langages et expressions régulières}
		\renewcommand{\cwd}{../td/td03/}
		\input{../td/td03/ex1.tex}
		\input{../td/td03/ex2.tex}
		\input{../td/td03/ex3.tex}
		\input{../td/td03/ex4.tex}
		\input{../td/td03/ex5.tex}
		\input{../td/td03/ex6.tex}
		\input{../td/td03/ex7.tex}
		\input{../td/td03/ex8.tex}
		\input{../td/td03/ex9.tex}
		\input{../td/td03/ex10.tex}
		\input{../td/td03/ex11.tex}
		\input{../td/td03/ex12.tex}
		\input{../td/td03/exsup1.tex}
	}

	{
		\td[4]{Langages et expressions régulières (2)}
		\renewcommand{\cwd}{../td/td04/}
		\input{../td/td04/ex01.tex}
		\input{../td/td04/ex02.tex}
		\input{../td/td04/ex03.tex}
		\input{../td/td04/ex04.tex}
		\input{../td/td04/ex05.tex}
	}

	{
		\td[5]{Langages et expressions régulières (3)}
		\renewcommand{\cwd}{../td/td05/}
		\input{../td/td05/ex05.tex}
		\input{../td/td05/ex01.tex}
		\input{../td/td05/ex04.tex}
		\input{../td/td05/ex06.tex}
	}

	{
		\td[6]{Algorithmes probabilistes}
		\renewcommand{\cwd}{../td/td06/}
		\input{../td/td06/ex01.tex}
		\input{../td/td06/ex02.tex}
		\input{../td/td06/ex03.tex}
	}
\end{document}
